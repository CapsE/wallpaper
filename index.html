<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wallpaper</title>
</head>
<body>
<div id="wrapper">

</div>

<script src="jquery-3.1.1.min.js"></script>
<script src="perlin.js"></script>
<script>
    var offsetX = 0;
    var offsetY = 0;
    var translateX = 0;
    var translateY = 0;
    var countX = window.innerWidth / 100 +2;
    var countY = window.innerHeight / 86 +2;
    var $body;
    $(document).ready(function(){

        $body = $("#wrapper");
        noise.seed(Math.random());

        for (var x = -2; x < countX * 2; x++) {
            for (var y = -2; y < countY; y++) {
                var r = (noise.simplex3(x / 100, y / 100, 0) +1)/2;
                var g = (noise.simplex3(x / 100, y / 100, 100)+1)/2;
                var b = (noise.simplex3(x / 100, y / 100, 200)+1)/2;

                var $tri = $('<svg  class="tri" version="1.1" baseProfile="full"xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"width="100px" height="87px" viewBox="0 0 502 435" > <polygon points="1,434 501,434 251,1" /> </svg>');

                $tri.attr("id", x + "-" + y);
                $tri.css({
                    "top": y*86,
                    "left": x*50,
                    "fill": "rgba(" + Math.round(r*255) + "," + Math.round(g*255) + "," + Math.round(b*255) + ",1)"
                });
                if(x%2 == 0){
                    $tri.css("transform", "rotate(180deg)");
                }
                if(y%2 == 0){
                    $tri.css("transform", $tri.css("transform") + " translate(-50px, 0)")
                }
                $body.append($tri);
            }
        }

        setInterval(function(){
            render();
        }, 1000/30);
    });

    function render() {
        translateX += dx;
        translateY += dy;
        if(translateX > 100 || translateX < -100){
            step(Math.sign(translateX),0);
            translateX = 0;
        }
        if(translateY > 86*2 || translateY < -86*2){
            step(0,Math.sign(translateY));
            translateY = 0;
        }
        $body.css("transform", "translate(" + translateX + "px," + translateY + "px)");
    }

    function step(xDir, yDir) {
        offsetX -= xDir;
        offsetY -= yDir;
        for (var x = -2; x < countX*2; x++) {
            for (var y = -2; y < countY; y++) {
                var r = (noise.simplex3((x + offsetX) / 100, (y + offsetY) / 100, 0) +1)/2;
                var g = (noise.simplex3((x + offsetX) / 100, (y + offsetY) / 100, 100)+1)/2;
                var b = (noise.simplex3((x + offsetX) / 100, (y + offsetY) / 100, 200)+1)/2;

                var $tri = $("#" + x + "-" + y);
                $tri.css({
                    "fill": "rgba(" + Math.round(r*255) + "," + Math.round(g*255) + "," + Math.round(b*255) + ",1)"
                });
            }
        }
    }

    var mousePos = [0,0];
    var dx = 0.5;
    var dy = 0;
    $(document).mousedown(function(e){
        mousePos = [e.pageX, e.pageY];
    });

    $(document).mouseup(function(e){
        var newMousePos = [e.pageX, e.pageY];

        dx = (newMousePos[0] - mousePos[0]) / 100;
        dy = (newMousePos[1] - mousePos[1]) / 100;
        console.log(dx);
    });

</script>
<style>
    html, body{
        padding:0px;
        margin:0px;
        width:100%;
        height:100%;
        overflow:hidden;
    }
    .tri{
        position: absolute;
        width:100px;
        height:100px;
    }

    #wrapper{

    }
</style>
</body>
</html>